!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("angular-jwt/lib/jwt-utils"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@auth0/angular-jwt",["exports","@angular/common","@angular/core","angular-jwt/lib/jwt-utils","rxjs","rxjs/operators","@angular/common/http"],t):t(((e=e||self).auth0=e.auth0||{},e.auth0["angular-jwt"]={}),e.ng.common,e.ng.core,e.jwtUtils,e.rxjs,e.rxjs.operators,e.ng.common.http)}(this,(function(e,t,r,n,o,i,a){"use strict";function s(e){if(!e||!e.hasOwnProperty("exp"))return null;var t=new Date(0);return t.setUTCSeconds(e.exp),t}function u(e){var t=e.split(".");if(3!==t.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");var r=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Illegal base64url string!")}return function(e){return decodeURIComponent(Array.prototype.map.call(function(e){var t="";if((e=String(e).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var r=0,n=void 0,o=void 0,i=0;o=e.charAt(i++);~o&&(n=r%4?64*n+o:o,r++%4)?t+=String.fromCharCode(255&n>>(-2*r&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return t}(e),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}(t)}(t[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}function c(e,t){void 0===t&&(t=0);var r=s(e);return null!==r&&!(r.valueOf()>(new Date).valueOf()+1e3*t)}var d=new r.InjectionToken("JWT_OPTIONS");function h(){return null}var p=function(){function e(e){void 0===e&&(e={}),this.tokenGetter=e.tokenGetter||h}return e.prototype.decodeToken=function(e){return void 0===e&&(e=this.tokenGetter()),e instanceof Promise?e.then((function(e){return u(e)})):e&&""!==e?u(e):null},e.prototype.getTokenExpirationDate=function(e){return void 0===e&&(e=this.tokenGetter()),e instanceof Promise?e.then(u).then((function(e){return s(e)})):s(u(e))},e.prototype.isTokenExpired=function(e,t){var r=this;return void 0===e&&(e=this.tokenGetter()),e instanceof Promise?e.then((function(e){return r.isTokenExpired(e,t)})):!e||""===e||c(e,t)},e.prototype.getAuthScheme=function(e,t){return"function"==typeof e?e(t):e},e}();function l(e,t){return"function"==typeof e?e(t):e}p.decorators=[{type:r.Injectable}],p.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[d]}]}]};var f=function(){function e(e,t,r){this.jwtHelper=t,this.document=r,this.standardPorts=["80","443"],this.tokenGetter=e.tokenGetter,this.headerName=e.headerName||"Authorization",this.authScheme=e.authScheme||""===e.authScheme?e.authScheme:"Bearer ",this.allowedDomains=e.allowedDomains||[],this.disallowedRoutes=e.disallowedRoutes||[],this.throwNoTokenError=e.throwNoTokenError||!1,this.skipWhenExpired=e.skipWhenExpired}return e.prototype.isAllowedDomain=function(e){var t=new URL(e.url,this.document.location.origin);if(t.host===this.document.location.host)return!0;var r=t.hostname+(t.port&&!this.standardPorts.includes(t.port)?":"+t.port:"");return this.allowedDomains.findIndex((function(e){return"string"==typeof e?e===r:e instanceof RegExp&&e.test(r)}))>-1},e.prototype.isDisallowedRoute=function(e){var t=this,r=new URL(e.url,this.document.location.origin);return this.disallowedRoutes.findIndex((function(n){if("string"==typeof n){var o=new URL(n,t.document.location.origin);return o.hostname===r.hostname&&o.pathname===r.pathname}return n instanceof RegExp&&n.test(e.url)}))>-1},e.prototype.handleInterception=function(e,t,r){var o,i=l(this.authScheme,t),a=!1;if(!e&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");return this.skipWhenExpired&&(a=!e||n.isTokenExpired(e)),e&&a&&this.skipWhenExpired?t=t.clone():e&&(t=t.clone({setHeaders:(o={},o[this.headerName]=""+i+e,o)})),r.handle(t)},e.prototype.intercept=function(e,t){var r=this;if(!this.isAllowedDomain(e)||this.isDisallowedRoute(e))return t.handle(e);var n=this.tokenGetter(e);return n instanceof Promise?o.from(n).pipe(i.mergeMap((function(n){return r.handleInterception(n,e,t)}))):this.handleInterception(n,e,t)},e}();f.decorators=[{type:r.Injectable}],f.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[d]}]},{type:p},{type:Document,decorators:[{type:r.Inject,args:[t.DOCUMENT]}]}]};var m=function(){function e(e){if(e)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:a.HTTP_INTERCEPTORS,useClass:f,multi:!0},t.jwtOptionsProvider||{provide:d,useValue:t.config},p]}},e}();m.decorators=[{type:r.NgModule}],m.ctorParameters=function(){return[{type:m,decorators:[{type:r.Optional},{type:r.SkipSelf}]}]},e.JWT_OPTIONS=d,e.JwtHelperService=p,e.JwtInterceptor=f,e.JwtModule=m,e.decodeToken=u,e.getAuthScheme=l,e.getTokenExpirationDate=s,e.isTokenExpired=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=auth0-angular-jwt.umd.min.js.map